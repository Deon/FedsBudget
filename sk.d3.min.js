!function(){var t,n,e={};e.alertVersion=function(){alert(this.version)},"undefined"!=typeof module&&"undefined"!=typeof exports&&"undefined"==typeof d3&&(d3=require("d3")),"undefined"!=typeof module&&"undefined"!=typeof exports&&(module.exports=e),"undefined"!=typeof window&&(window.sk=e),t=this,n=function(t,n,e,r){"use strict";function o(t){return t.target.depth}function i(t,n){return t.sourceLinks.length?t.depth:n-1}function a(t){return function(){return t}}function u(t,n){return d(t.source,n.source)||t.index-n.index}function s(t,n){return d(t.target,n.target)||t.index-n.index}function d(t,n){return t.y0-n.y0}function l(t){return t.value}function c(t){return(t.y0+t.y1)/2}function f(t){return c(t.source)*t.value}function h(t){return c(t.target)*t.value}function p(t){return t.index}function g(t){return t.nodes}function y(t){return t.links}function m(t,n){var e=t.get(n);if(!e)throw new Error("missing: "+n);return e}function v(t){return[t.source.x1,t.y0]}function x(t){return[t.target.x0,t.y1]}t.sankey=function(){function t(){var t={nodes:M.apply(null,arguments),links:z.apply(null,arguments)};return function(t){t.nodes.forEach(function(t,n){t.index=n,t.sourceLinks=[],t.targetLinks=[]});var n=e.map(t.nodes,L);t.links.forEach(function(t,e){t.index=e;var r=t.source,o=t.target;"object"!=typeof r&&(r=t.source=m(n,r)),"object"!=typeof o&&(o=t.target=m(n,o)),r.sourceLinks.push(t),o.targetLinks.push(t)})}(t),t.nodes.forEach(function(t){t.value=Math.max(n.sum(t.sourceLinks,l),n.sum(t.targetLinks,l))}),function(t){var n,e,r;for(n=t.nodes,e=[],r=0;n.length;++r,n=e,e=[])n.forEach(function(t){t.depth=r,t.sourceLinks.forEach(function(t){e.indexOf(t.target)<0&&e.push(t.target)})});for(n=t.nodes,e=[],r=0;n.length;++r,n=e,e=[])n.forEach(function(t){t.height=r,t.targetLinks.forEach(function(t){e.indexOf(t.source)<0&&e.push(t.source)})});var i=(x-o-w)/(r-1);t.nodes.forEach(function(t){t.x1=(t.x0=o+Math.max(0,Math.min(r-1,Math.floor(E.call(null,t,r))))*i)+w})}(t),function(t){function r(){i.forEach(function(t){var n,e,r,o=v,i=t.length;for(t.sort(d),r=0;r<i;++r)(e=o-(n=t[r]).y0)>0&&(n.y0+=e,n.y1+=e),o=n.y1+b;if((e=o-b-k)>0)for(o=n.y0-=e,n.y1-=e,r=i-2;r>=0;--r)(e=(n=t[r]).y1+b-o)>0&&(n.y0-=e,n.y1-=e),o=n.y0})}var o,i=e.nest().key(function(t){return t.x0}).sortKeys(n.ascending).entries(t.nodes).map(function(t){return t.values});o=n.min(i,function(t){return(k-v-(t.length-1)*b)/n.sum(t,l)}),i.forEach(function(t){t.forEach(function(t,n){t.y1=(t.y0=n)+t.value*o})}),t.links.forEach(function(t){t.width=t.value*o}),r();for(var a=1,u=S;u>0;--u)!function(t){i.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var r=(n.sum(e.sourceLinks,h)/n.sum(e.sourceLinks,l)-c(e))*t;e.y0+=r,e.y1+=r}})})}(a*=.99),r(),function(t){i.forEach(function(e){e.forEach(function(e){if(e.targetLinks.length){var r=(n.sum(e.targetLinks,f)/n.sum(e.targetLinks,l)-c(e))*t;e.y0+=r,e.y1+=r}})})}(a),r()}(t),r(t),t}function r(t){t.nodes.forEach(function(t){t.sourceLinks.sort(s),t.targetLinks.sort(u)}),t.nodes.forEach(function(t){var n=t.y0,e=n;t.sourceLinks.forEach(function(t){t.y0=n+t.width/2,n+=t.width}),t.targetLinks.forEach(function(t){t.y1=e+t.width/2,e+=t.width})})}var o=0,v=0,x=1,k=1,w=24,b=8,L=p,E=i,M=g,z=y,S=32;return t.update=function(t){return r(t),t},t.nodeId=function(n){return arguments.length?(L="function"==typeof n?n:a(n),t):L},t.nodeAlign=function(n){return arguments.length?(E="function"==typeof n?n:a(n),t):E},t.nodeWidth=function(n){return arguments.length?(w=+n,t):w},t.nodePadding=function(n){return arguments.length?(b=+n,t):b},t.nodes=function(n){return arguments.length?(M="function"==typeof n?n:a(n),t):M},t.links=function(n){return arguments.length?(z="function"==typeof n?n:a(n),t):z},t.size=function(n){return arguments.length?(o=v=0,x=+n[0],k=+n[1],t):[x-o,k-v]},t.extent=function(n){return arguments.length?(o=+n[0][0],x=+n[1][0],v=+n[0][1],k=+n[1][1],t):[[o,v],[x,k]]},t.iterations=function(n){return arguments.length?(S=+n,t):S},t},t.sankeyCenter=function(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?n.min(t.sourceLinks,o)-1:0},t.sankeyLeft=function(t){return t.depth},t.sankeyRight=function(t,n){return n-1-t.height},t.sankeyJustify=i,t.sankeyLinkHorizontal=function(){return r.linkHorizontal().source(v).target(x)},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-shape"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3),function(t,n){if("function"==typeof define&&define.amd)define(["d3"],n);else if("object"==typeof module&&module.exports){var e=require("d3");module.exports=n(e)}else t.d3.tip=n(t.d3)}(this,function(t){return function(){var n=function(){return"n"},e=function(){return[0,0]},r=function(){return" "},o=c(),i=null,a=null,u=null;function s(t){var n;i="svg"===(n=(n=t).node()).tagName.toLowerCase()?n:n.ownerSVGElement,a=i.createSVGPoint(),document.body.appendChild(o)}s.show=function(){var t=Array.prototype.slice.call(arguments);t[t.length-1]instanceof SVGElement&&(u=t.pop());var o,i=r.apply(this,t),a=e.apply(this,t),c=n.apply(this,t),h=f(),p=l.length,g=document.documentElement.scrollTop||document.body.scrollTop,y=document.documentElement.scrollLeft||document.body.scrollLeft;for(h.html(i).style("opacity",1).style("pointer-events","all");p--;)h.classed(l[p],!1);return o=d.get(c).apply(this),h.classed(c,!0).style("top",o.top+a[0]+g+"px").style("left",o.left+a[1]+y+"px"),s},s.hide=function(){return f().style("opacity",0).style("pointer-events","none"),s},s.attr=function(n,e){if(arguments.length<2&&"string"==typeof n)return f().attr(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(f(),r),s},s.style=function(n,e){if(arguments.length<2&&"string"==typeof n)return f().style(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(f(),r),s},s.direction=function(t){return arguments.length?(n=null==t?t:p(t),s):n},s.offset=function(t){return arguments.length?(e=null==t?t:p(t),s):e},s.html=function(t){return arguments.length?(r=null==t?t:p(t),s):r},s.destroy=function(){return o&&(f().remove(),o=null),s};var d=t.map({n:function(){var t=h();return{top:t.n.y-o.offsetHeight,left:t.n.x-o.offsetWidth/2}},s:function(){var t=h();return{top:t.s.y,left:t.s.x-o.offsetWidth/2}},e:function(){var t=h();return{top:t.e.y-o.offsetHeight/2,left:t.e.x}},w:function(){var t=h();return{top:t.w.y-o.offsetHeight/2,left:t.w.x-o.offsetWidth}},nw:function(){var t=h();return{top:t.nw.y-o.offsetHeight,left:t.nw.x-o.offsetWidth}},ne:function(){var t=h();return{top:t.ne.y-o.offsetHeight,left:t.ne.x}},sw:function(){var t=h();return{top:t.sw.y,left:t.sw.x-o.offsetWidth}},se:function(){var t=h();return{top:t.se.y,left:t.e.x}}}),l=d.keys();function c(){var n=t.select(document.createElement("div"));return n.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),n.node()}function f(){return null===o&&(o=c(),document.body.appendChild(o)),t.select(o)}function h(){for(var n=u||t.event.target;void 0===n.getScreenCTM&&"undefined"===n.parentNode;)n=n.parentNode;var e={},r=n.getScreenCTM(),o=n.getBBox(),i=o.width,s=o.height,d=o.x,l=o.y;return a.x=d,a.y=l,e.nw=a.matrixTransform(r),a.x+=i,e.ne=a.matrixTransform(r),a.y+=s,e.se=a.matrixTransform(r),a.x-=i,e.sw=a.matrixTransform(r),a.y-=s/2,e.w=a.matrixTransform(r),a.x+=i,e.e=a.matrixTransform(r),a.x-=i/2,a.y-=s/2,e.n=a.matrixTransform(r),a.y+=s,e.s=a.matrixTransform(r),e}function p(t){return"function"==typeof t?t:function(){return t}}return s}}),e.createSankey=function(t,n,e){var r=function(t){return Math.max(t,Number.MIN_VALUE)},o={nodes:[],links:[]};e.nodes.map(function(t){o.nodes.push({name:t.name,color:t.color,id:t.id})}),e.links.map(function(t){o.links.push({source:t.source,target:t.target,id:t.id,value:r(t.value)})});!function(t){for(var n=0;n<t.length;n++)void 0==t[n].id&&(t[n].id=t[n].source+" -> "+t[n].target)}(o.links),d3.select(".d3-tip-nodes").remove(),d3.select(".d3-tip").remove(),d3.select(t+" svg").remove();var i=d3.select(t);var a,u,s,d,l=(a=i,u=n.margin,{width:(s=a.node().getBoundingClientRect()).width-u.left-u.right,height:s.height-u.top-u.bottom}),c=i.append("svg").attr("width",l.width+n.margin.left+n.margin.right).attr("height",l.height+n.margin.top+n.margin.bottom).attr("class","sk-svg").append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),f=d3.sankey().nodeWidth(15).nodePadding(n.nodes.padding).nodeAlign(d3.sankeyLeft).extent([[0,0],[l.width,l.height]]),h=d3.sankeyLinkHorizontal(),p=function(t){return n.nodes.fontSize},g=function(t){};n.nodes.dynamicSizeFontNode.enabled&&(d=d3.scaleLinear().range([n.nodes.dynamicSizeFontNode.minSize,n.nodes.dynamicSizeFontNode.maxSize]),g=function(t){d.domain(d3.extent(t,function(t){return t.value}))},p=function(t){return Math.floor(d(t.value))});var y=!1,m=!0;void 0!=n.nodes.draggableX&&(y=n.nodes.draggableX),void 0!=n.nodes.draggableY&&(m=n.nodes.draggableY);for(var v=0;v<o.nodes.length;v++)void 0==o.nodes[v].color&&(o.nodes[v].color=n.nodes.colors(o.nodes[v].name.replace(/ .*/,"")));var x=d3.tip().attr("class","d3-tip").offset([-10,0]),k=d3.tip().attr("class","d3-tip d3-tip-nodes").offset([-10,0]);function w(t){return n.links.formatValue?n.links.formatValue(t):t+" "+n.links.unit}x.html(function(t){var n,e;return o.links.indexOf(t.source.name)>-1?(e=t.source.name,n=t.target.name):(e=t.target.name,n=t.source.name),'<div class="table-wrapper"><center><h1>'+n+'</h1></center><table><tr><td class="col-left">'+e+'</td><td align="right">'+w(t.value)+"</td></tr></table></div>"});var b=d3.select(".sk-svg").node().getBoundingClientRect().top;x.move=function(t){x.style("top",function(){return d3.event.pageY-b-65>=0?d3.event.pageY-65+"px":d3.event.pageY+20+"px"}).style("left",function(){var t=Math.max(d3.event.pageX-65,10);return(t=Math.min(t,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})},k.html(function(t){var e,r=t.name,o=t.targetLinks,i=t.sourceLinks;for(e='<div class="table-wrapper"><center><h1>'+r+"</h1></center><table>",o.length>0&i.length>0&&(e+="<tr><td><h2>"+n.tooltip.labelSource+"</h2></td><td></td></tr>"),v=0;v<o.length;++v)e+='<tr><td class="col-left">'+o[v].source.name+'</td><td align="right">'+w(o[v].value)+"</td></tr>";for(o.length>0&i.length>0&&(e+="<tr><td></td><td></td><tr><td></td><td></td> </tr><tr><td><h2>"+n.tooltip.labelTarget+"</h2></td><td></td></tr>"),v=0;v<i.length;++v)e+='<tr><td class="col-left">'+i[v].target.name+'</td><td align="right">'+w(i[v].value)+"</td></tr>";return e+="</table></div>"}),k.move=function(t){k.boxInfo=d3.select(".d3-tip-nodes").node().getBoundingClientRect(),k.style("top",function(){return d3.event.pageY-b-k.boxInfo.height-20>=0?d3.event.pageY-k.boxInfo.height-20+"px":d3.event.pageY+20+"px"}).style("left",function(){var t=Math.max(d3.event.pageX-130,10);return(t=Math.min(t,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})},c.call(x),c.call(k);var L=function(){x&&x.hide(),k&&k.hide()};f(o),g(o.nodes);var E=c.append("g").selectAll(".sk-link").data(o.links,function(t){return t.id}).enter().append("path").attr("class","sk-link").attr("d",h).style("stroke",function(t){return t.source.color}).style("stroke-width",function(t){return Math.max(1,t.width)+"px"}).sort(function(t,n){return n.width-t.width});n.tooltip.infoDiv?E.on("mousemove",x.move).on("mouseover",x.show).on("mouseout",x.hide):E.append("title").text(function(t){return t.source.name+" -> "+t.target.name+"\n"+w(t.value)});var M=c.append("g").selectAll(".sk-node").data(o.nodes,function(t){return t.name}).enter().append("g").attr("class","sk-node").attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"});n.tooltip.infoDiv?M.on("mousemove",k.move).on("mouseover",k.show).on("mouseout",k.hide):M.append("title").text(function(t){return t.name+"\n"+w(t.value)}),(y||m)&&M.call(d3.drag().subject(function(t){return t}).on("start",function(t){d3.event.sourceEvent.stopPropagation(),this.parentNode.appendChild(this)}).on("drag",function(t){if(L(),y&&d3.event.x<l.width&&(t.x0=Math.max(0,Math.min(l.width-f.nodeWidth(),t.x0+d3.event.dx)),t.x1=t.x0+f.nodeWidth()),m&&d3.event.y<l.height){var n=t.y1-t.y0;t.y0=Math.max(0,Math.min(l.height-(t.y1-t.y0),t.y0+d3.event.dy)),t.y1=t.y0+n}d3.select(this).attr("transform","translate("+t.x0+","+t.y0+")"),f.update(o),E.attr("d",h)})),M.append("rect").attr("height",function(t){return t.y1-t.y0}).attr("width",f.nodeWidth()).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker(1.8)}),M.append("text").attr("x",-6).attr("y",function(t){return(t.y1-t.y0)/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).style("fill",function(t){return d3.rgb(t.color).darker(2.4)}).text(function(t){return t.name}).style("font-size",function(t){return p(t)+"px"}).filter(function(t){return t.x0<l.width/2}).attr("x",6+f.nodeWidth()).attr("text-anchor","start");return this.updateData=function(t){for(var n=0;n<t.links.length;n++){var e=t.links[n].id||t.links[n].source+" -> "+t.links[n].target,i=o.links.filter(function(t){return t.id==e})[0];i&&(i.value=r(t.links[n].value))}var a;a=o,L(),f(a),f.update(a),g(a.nodes),c.selectAll(".sk-link").data(a.links,function(t){return t.id}).sort(function(t,n){return n.width-t.width}).transition().duration(1300).attr("d",h).style("stroke-width",function(t){return Math.max(1,t.width)+"px"}),c.selectAll(".sk-node").data(a.nodes,function(t){return t.name}).transition().duration(1300).attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"}),c.selectAll(".sk-node rect").transition().duration(1300).attr("height",function(t){return t.y1-t.y0}),c.selectAll(".sk-node text").transition().duration(1300).attr("y",function(t){return(t.y1-t.y0)/2}).style("font-size",function(t){return p(t)+"px"})},this},e.version="0.2.0"}();